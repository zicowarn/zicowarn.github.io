<!DOCTYPE html>
<html lang="zh-cn">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Inno Setup 在x86和x64环境下安装-NET安装包 - Barbossa Wang 个人技术博客</title>
  
    <link rel="shortcut icon" href="/assets/images/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Inno Setup 在x86和x64环境下安装-NET安装包 - Barbossa Wang 个人技术博客" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="https://zicowarn.github.io/posts/inno-02-installdotnet.html" />
  
  <meta property="og:image" content="assets/images/favicon.png" />
  
  <meta property="og:article:published_time" content="2019-06-30T00:11:08.000Z" />
  
  <meta property="og:article:author" content="Barbossa Wang" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 5.4.2"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">主页</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/tags">Tags</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/zicowarn" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/Inno-Setup-相关-实战经验/">Inno Setup 相关 - 实战经验</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>June</span>
            <span>30,</span>
            <span>2019</span>
        </div>
        

        <h1 class="title">Inno Setup 在x86和x64环境下安装-NET安装包</h1>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>作者: Jim Wang 公众号: <a class="main-button-link" href="#wechat" rel="noopener">巴博萨船长</a></p>
<h3 id="任务难点"><a href="#任务难点" class="headerlink" title="任务难点"></a>任务难点</h3><p>准备一个安装程序，以验证系统的体系结构并安装.NET。</p>
<h3 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h3><p>此安装脚本示例的目的是启动一个安装程序，该安装程序检查系统上当前安装的.NET版本，并仅在需要时安装一个。安装程序将在软件包中包括Microsoft提供的Web安装程序。 安装程序还将根据运行所在的体系结构安装一些库。</p>
<span id="more"></span>

<h3 id="2-背景"><a href="#2-背景" class="headerlink" title="2. 背景"></a>2. 背景</h3><p>出于我们的目的，我们需要可从Microsoft下载站点下载的InnoSetup编译器和.NET Framework Web安装程序文件。Microsoft维护一组注册表项，这些注册表项指示已安装的.NET Framework版本和Service Pack。C＃MVP Scott Dorman在此<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/199080/how-to-detect-what-net-framework-versions-and-service-packs-are-installed">Stack Overflow线程中</a>发布了一个列表，其中包含版本1.0到4.0（在撰写本文时）。除1.0以外，大多数.NET Framework版本所需的注册表项都非常相似。无论如何，我们将忽略该版本已被1.1淘汰的版本。</p>
<p>4.5版和更高版本有些棘手，因为它们可以作为4.0版的就地更新安装并重用完全相同的注册表项。MSDN官方页面“ <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed">如何：确定安装的.NET Framework版本”</a>建议检查<code>DWORD</code>value 的存在<code>Release</code>，所以我在下面做这件事。替代方法是检查.NET 4.0 的<code>REG_SZ</code>值<code>Version</code>4.0.30319，.NET 4.5的4.5.50709和.NET 4.6的4.6.00079。（可悲的是，在安装它们时，我不认为要记录4.5.1和4.5.2的版本字符串。）</p>
<p>4.5.1版引入了另一个复杂性：根据Windows版本，可能有<em>两个</em><code>Release</code>值！该脚本通过将所有4.5版或更高版本的查询视为_最低_要求来处理此问题，即，如果该<code>Release</code>值等于或大于任何系统上指定版本的最小值，则这些查询将成功。.NET 4.5或更高版本也可以满足.NET 4.0的查询，因为后者是作为就地更新安装的。对较早版本的查询需要完全匹配，即，即使应用程序兼容，.NET 4.0或更高版本也_无法_满足它们。</p>
<h3 id="3-代码部分"><a href="#3-代码部分" class="headerlink" title="3. 代码部分"></a>3. 代码部分</h3><p>在[Code]部分，我们定义如下函数来检测以安装的.NET版本。该部分代码取自Jordan Russell的网站。 在下面的Inno Setup脚本代码块中，函数<code>IsDotNetDetected</code>检查是否安装了指定的.NET Framework版本和至少指定的Service Pack级别。所有列出的版本字符串均适用于最终发行版本；测试版和发行候选版通常具有不同的版本号。函数<code>InitializeSetup</code>演示了如何使用<code>IsDotNetDetected</code>不带Service Pack的.NET Framework 4.6进行检查。 原始代码如下：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">[Code]</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsDotNetDetected</span><span class="params">(version: <span class="keyword">string</span>; service: cardinal)</span>:</span> boolean;</span><br><span class="line"><span class="comment">// Indicates whether the specified version and service pack of the .NET Framework is installed.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// version -- Specify one of these strings for the required .NET Framework version:</span></span><br><span class="line"><span class="comment">//    &#x27;v1.1&#x27;          .NET Framework 1.1</span></span><br><span class="line"><span class="comment">//    &#x27;v2.0&#x27;          .NET Framework 2.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.0&#x27;          .NET Framework 3.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.5&#x27;          .NET Framework 3.5</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Client&#x27;     .NET Framework 4.0 Client Profile</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Full&#x27;       .NET Framework 4.0 Full Installation</span></span><br><span class="line"><span class="comment">//    &#x27;v4.5&#x27;          .NET Framework 4.5</span></span><br><span class="line"><span class="comment">//    &#x27;v4.5.1&#x27;        .NET Framework 4.5.1</span></span><br><span class="line"><span class="comment">//    &#x27;v4.5.2&#x27;        .NET Framework 4.5.2</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6&#x27;          .NET Framework 4.6</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.1&#x27;        .NET Framework 4.6.1</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.2&#x27;        .NET Framework 4.6.2</span></span><br><span class="line"><span class="comment">//    &#x27;v4.7&#x27;          .NET Framework 4.7</span></span><br><span class="line"><span class="comment">//    &#x27;v4.7.1&#x27;        .NET Framework 4.7.1</span></span><br><span class="line"><span class="comment">//    &#x27;v4.7.2&#x27;        .NET Framework 4.7.2</span></span><br><span class="line"><span class="comment">//    &#x27;v4.8&#x27;          .NET Framework 4.8</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// service -- Specify any non-negative integer for the required service pack level:</span></span><br><span class="line"><span class="comment">//    0               No service packs required</span></span><br><span class="line"><span class="comment">//    1, 2, etc.      Service pack 1, 2, etc. required</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    key, versionKey: <span class="keyword">string</span>;</span><br><span class="line">    install, release, serviceCount, versionRelease: cardinal;</span><br><span class="line">    success: boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    versionKey := version;</span><br><span class="line">    versionRelease := <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 1.1 and 2.0 embed release number in version key</span></span><br><span class="line">    <span class="keyword">if</span> version = <span class="string">&#x27;v1.1&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        versionKey := <span class="string">&#x27;v1.1.4322&#x27;</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> version = <span class="string">&#x27;v2.0&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        versionKey := <span class="string">&#x27;v2.0.50727&#x27;</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.5 and newer install as update to .NET 4.0 Full</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> Pos(<span class="string">&#x27;v4.&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        versionKey := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> version <span class="keyword">of</span></span><br><span class="line">          <span class="string">&#x27;v4.5&#x27;</span>:   versionRelease := <span class="number">378389</span>;</span><br><span class="line">          <span class="string">&#x27;v4.5.1&#x27;</span>: versionRelease := <span class="number">378675</span>; <span class="comment">// 378758 on Windows 8 and older</span></span><br><span class="line">          <span class="string">&#x27;v4.5.2&#x27;</span>: versionRelease := <span class="number">379893</span>;</span><br><span class="line">          <span class="string">&#x27;v4.6&#x27;</span>:   versionRelease := <span class="number">393295</span>; <span class="comment">// 393297 on Windows 8.1 and older</span></span><br><span class="line">          <span class="string">&#x27;v4.6.1&#x27;</span>: versionRelease := <span class="number">394254</span>; <span class="comment">// 394271 before Win10 November Update</span></span><br><span class="line">          <span class="string">&#x27;v4.6.2&#x27;</span>: versionRelease := <span class="number">394802</span>; <span class="comment">// 394806 before Win10 Anniversary Update</span></span><br><span class="line">          <span class="string">&#x27;v4.7&#x27;</span>:   versionRelease := <span class="number">460798</span>; <span class="comment">// 460805 before Win10 Creators Update</span></span><br><span class="line">          <span class="string">&#x27;v4.7.1&#x27;</span>: versionRelease := <span class="number">461308</span>; <span class="comment">// 461310 before Win10 Fall Creators Update</span></span><br><span class="line">          <span class="string">&#x27;v4.7.2&#x27;</span>: versionRelease := <span class="number">461808</span>; <span class="comment">// 461814 before Win10 April 2018 Update</span></span><br><span class="line">          <span class="string">&#x27;v4.8&#x27;</span>:   versionRelease := <span class="number">528040</span>; <span class="comment">// 528049 before Win10 May 2019 Update</span></span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// installation key group for all .NET versions</span></span><br><span class="line">    key := <span class="string">&#x27;SOFTWARE\Microsoft\NET Framework Setup\NDP\&#x27;</span> + versionKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 3.0 uses value InstallSuccess in subkey Setup</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v3.0&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key + <span class="string">&#x27;\Setup&#x27;</span>, <span class="string">&#x27;InstallSuccess&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Install&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.0 and newer use value Servicing instead of SP</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v4&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Servicing&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;SP&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.5 and newer use additional value Release</span></span><br><span class="line">    <span class="keyword">if</span> versionRelease &gt; <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Release&#x27;</span>, release);</span><br><span class="line">        success := success <span class="keyword">and</span> (release &gt;= versionRelease);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    result := success <span class="keyword">and</span> (install = <span class="number">1</span>) <span class="keyword">and</span> (serviceCount &gt;= service);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InitializeSetup</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> IsDotNetDetected(<span class="string">&#x27;v4.6&#x27;</span>, <span class="number">0</span>) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">&#x27;MyApp requires Microsoft .NET Framework 4.6.&#x27;</span><span class="string">#13#13</span></span><br><span class="line">            <span class="string">&#x27;Please use Windows Update to install this version,&#x27;</span><span class="string">#13</span></span><br><span class="line">            <span class="string">&#x27;and then re-run the MyApp setup program.&#x27;</span>, mbInformation, MB_OK);</span><br><span class="line">        result := false;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">        result := true;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>针对此代码，我们修改为如下形式：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[Code]</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsDotNetDetected</span><span class="params">(version: <span class="keyword">string</span>; service: cardinal)</span>:</span> boolean;</span><br><span class="line"><span class="comment">// Indicates whether the specified version and service pack of the .NET Framework is installed.</span></span><br><span class="line"><span class="comment">// see the link: https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed?redirectedfrom=MSDN#net_b</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// version -- Specify one of these strings for the required .NET Framework version:</span></span><br><span class="line"><span class="comment">//    &#x27;v1.1.4322&#x27;     .NET Framework 1.1</span></span><br><span class="line"><span class="comment">//    &#x27;v2.0.50727&#x27;    .NET Framework 2.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.0&#x27;          .NET Framework 3.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.5&#x27;          .NET Framework 3.5</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Client&#x27;     .NET Framework 4.0 Client Profile</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Full&#x27;       .NET Framework 4.0 Full Installation</span></span><br><span class="line"><span class="comment">//    &#x27;v4.5&#x27;          .NET Framework 4.5 378389</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6&#x27;          .NET Framework 4.6 393295</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.1&#x27;        .NET Framework 4.6.1 394254</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.2&#x27;        .NET Framework 4.6.2 394802</span></span><br><span class="line"><span class="comment">//    &#x27;v4.7&#x27;          .NET Framework 4.7 393295</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// service -- Specify any non-negative integer for the required service pack level:</span></span><br><span class="line"><span class="comment">//    0               No service packs required</span></span><br><span class="line"><span class="comment">//    1, 2, etc.      Service pack 1, 2, etc. required</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    key: <span class="keyword">string</span>;</span><br><span class="line">    install, release, serviceCount: cardinal;</span><br><span class="line">    check45, success: boolean;</span><br><span class="line"><span class="keyword">var</span> reqNetVer : <span class="keyword">string</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// .NET 4.5 installs as update to .NET 4.0 Full</span></span><br><span class="line">    <span class="keyword">if</span> version = <span class="string">&#x27;v4.5&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        version := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">        check45 := true;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">        check45 := false;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// installation key group for all .NET versions</span></span><br><span class="line">    key := <span class="string">&#x27;SOFTWARE\Microsoft\NET Framework Setup\NDP\&#x27;</span> + version;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 3.0 uses value InstallSuccess in subkey Setup</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v3.0&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key + <span class="string">&#x27;\Setup&#x27;</span>, <span class="string">&#x27;InstallSuccess&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Install&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.0/4.5 uses value Servicing instead of SP</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v4&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Servicing&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;SP&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.5 uses additional value Release</span></span><br><span class="line">    <span class="keyword">if</span> check45 <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Release&#x27;</span>, release);</span><br><span class="line">        success := success <span class="keyword">and</span> (release &gt;= <span class="number">378389</span>);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    result := success <span class="keyword">and</span> (install = <span class="number">1</span>) <span class="keyword">and</span> (serviceCount &gt;= service);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>这是一个全局函数，用于验证是否正确安装了作为参数传递的.NET Framework版本。 现在，我们应该编写一个由安装程序在运行时调用的简单函数，以验证是否已安装所需的.NET版本。我们将以4.0为例。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function IsRequiredDotNetDetected(): Boolean;  </span><br><span class="line">begin</span><br><span class="line">    result := IsDotNetDetected(&#x27;v4\Full&#x27;, 0);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<p>如果需要，我们还可以在设置过程中发布一条消息：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InitializeSetup</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> IsDotNetDetected(<span class="string">&#x27;v4\Full&#x27;</span>, <span class="number">0</span>) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        MsgBox(<span class="string">&#x27;&#123;#MyAppName&#125; requires Microsoft .NET Framework 4.0 Client Profile.&#x27;</span><span class="string">#13#13</span></span><br><span class="line">          <span class="string">&#x27;The installer will attempt to install it&#x27;</span>, mbInformation, MB_OK);        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    result := true;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>代码部分已经完成，现在我们可以关注**[Files]**部分。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Files]</span><br><span class="line">Source: &quot;&#123;#MyDistFolder&#125;\dotNetFx40_Full_setup.exe&quot;; DestDir: &#123;tmp&#125;; Flags: deleteafterinstall; Check: not IsRequiredDotNetDetected</span><br></pre></td></tr></table></figure>

<p>安装程序将复制.NET安装程序文件（这大约是850 KB的智能文件），<strong>只有</strong>在没有已经存在于系统中，到<strong>系统临时</strong>目录。安装完成后，该文件将被删除。现在已经复制了网络安装程序，如果需要，我们需要运行它。 在**[run]**部分中，输入以下内容：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Run]</span><br><span class="line">Filename: &#123;tmp&#125;\dotNetFx40_Full_setup.exe; Parameters: &quot;/q:a /c:&quot;&quot;install /l </span><br><span class="line">  /q&quot;&quot;&quot;; Check: not IsRequiredDotNetDetected; StatusMsg: Microsoft Framework 4.0 is beïng installed. Please wait...</span><br></pre></td></tr></table></figure>

<h3 id="4-x86-x64选项"><a href="#4-x86-x64选项" class="headerlink" title="4. x86 / x64选项"></a>4. x86 / x64选项</h3><p>此示例显示安装程序如何根据系统体系结构运行。它将安装系统所需的本机库，以进行更智能的安装。在 **[setuo]**部分中，定义以下指令：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArchitecturesInstallIn64BitMode=x64</span><br></pre></td></tr></table></figure>

<p>这两行将根据系统安装一个lib文件夹：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Source: &quot;&#123;#MyDistFolder&#125;\lib\x64\*&quot;; DestDir: &quot;&#123;app&#125;\lib\x64&quot;; Check: Is64BitInstallMode; Flags: ignoreversion recursesubdirs createallsubdirs</span><br><span class="line">Source: &quot;&#123;#MyDistFolder&#125;\lib\x86\*&quot;; DestDir: &quot;&#123;app&#125;\lib\x86&quot;; Check: not Is64BitInstallMode; Flags: ignoreversion recursesubdirs createallsubdirs</span><br></pre></td></tr></table></figure>

<h3 id="5-有关安装-NET过程代码的其它解决方案"><a href="#5-有关安装-NET过程代码的其它解决方案" class="headerlink" title="5. 有关安装.NET过程代码的其它解决方案"></a>5. 有关安装.NET过程代码的其它解决方案</h3><p>如果不行实现InnoSetup中的AfterInstall的标识，希望.NET的安装在文件**[Files]**执行的某一步骤时被执行，就需要主意.NET的执行顺序。请参看如下两部分代码。</p>
<p>使用安装的返回值</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Code]</span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">InstallFramework</span>;</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\dotNetFx40_Full_x86_x64.exe&#x27;</span>), <span class="string">&#x27;/q /norestart&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">&#123; you can interact with the user that the installation failed &#125;</span></span><br><span class="line">    MsgBox(<span class="string">&#x27;.NET installation failed with code: &#x27;</span> + IntToStr(ResultCode) + <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">      mbError, MB_OK);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>使用进度条显示安装进度，但是由于要获得.NET安装程序的安装进度并不容易，因此我将在安装执行过程中向用户简单显示无休止的选取框进度栏。 即，该进度条仅在此具用于显示，不能准确表示安装的进度。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">InstallFramework</span>;</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  StatusText: <span class="keyword">string</span>;</span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  StatusText := WizardForm.StatusLabel.Caption;</span><br><span class="line">  WizardForm.StatusLabel.Caption := <span class="string">&#x27;Installing .NET framework...&#x27;</span>;</span><br><span class="line">  WizardForm.ProgressGauge.Style := npbstMarquee;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\dotNetFx45_Full_asetup.exe&#x27;</span>), <span class="string">&#x27;/q /norestart&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// you can interact with the user that the installation failed</span></span><br><span class="line">    MsgBox(<span class="string">&#x27;.NET installation failed with code: &#x27;</span> + IntToStr(ResultCode) + <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">      mbError, MB_OK);</span><br><span class="line">    CancelWithoutPrompt := true;</span><br><span class="line">    WizardForm.Close;       </span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">finally</span></span><br><span class="line">    WizardForm.StatusLabel.Caption := StatusText;</span><br><span class="line">    WizardForm.ProgressGauge.Style := npbstNormal;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-提示"><a href="#6-提示" class="headerlink" title="6. 提示"></a>6. 提示</h3><p>Inno 是具有一个内置变量{dotnet40}的，ExpandConstant(‘{dotnet40}’)。其它有关的变量为：</p>
<p><strong>{dotnet11}</strong></p>
<p>32-bit .NET Framework version 1.1 root directory.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 1.1 present.</p>
<p>32位.NET Framework 1.1版根目录。</p>
<p>会将系统扩展到当前的.NET Framework版本1.1会发生例外。</p>
<p><strong>{dotnet20}</strong></p>
<p>.NET Framework version 2.0-3.5 root directory. <code>&#123;dotnet20&#125;</code> is equivalent to <code>&#123;dotnet2032&#125;</code> unless the install is running in [64-bit install mode], in which case it is equivalent to <code>&#123;dotnet2064&#125;</code>.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 2.0-3.5 present.</p>
<p>.NET Framework 2.0-3.5版根目录。除非安装以64位安装模式运行，否则{dotnet20}等效于{dotnet2032}，在这种情况下，等效于{dotnet2064}。</p>
<p>会将系统扩展到当前的.NET Framework版本2.0-3.5将会发生例外。</p>
<p><strong>{dotnet2032}</strong></p>
<p>32-bit .NET Framework version 2.0-3.5 root directory.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 2.0-3.5 present.</p>
<p>32位.NET Framework 2.0-3.5版根目录。</p>
<p>会将系统扩展到当前的.NET Framework版本2.0-3.5将会发生例外。</p>
<p><strong>{dotnet2064}</strong></p>
<p>64-bit Windows only: 64-bit .NET Framework version 2.0-3.5 root directory.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 2.0-3.5 present.</p>
<p>仅适用于64位Windows：64位.NET Framework 2.0-3.5版根目录。</p>
<p>会将系统扩展到当前的.NET Framework版本2.0-3.5将会发生例外。</p>
<p><strong>{dotnet40}</strong></p>
<p>.NET Framework version 4.0 and later root directory. <code>&#123;dotnet40&#125;</code> is equivalent to <code>&#123;dotnet4032&#125;</code> unless the install is running in [64-bit install mode], in which case it is equivalent to <code>&#123;dotnet4064&#125;</code>.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 4.0 or later present.</p>
<p>.NET Framework 4.0版和更高版本的根目录。除非安装以64位安装模式运行，否则{dotnet40}等效于{dotnet4032}，在这种情况下，等效于{dotnet4064}。</p>
<p>将系统扩展到.NET Framework 4.0或更高版本时，将发生例外。</p>
<p><strong>{dotnet4032}</strong></p>
<p>32-bit .NET Framework version 4.0 and later root directory.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 4.0 or later present.</p>
<p>32位.NET Framework 4.0版和更高版本的根目录。</p>
<p>将系统扩展到.NET Framework 4.0或更高版本时，将发生例外。</p>
<p><strong>{dotnet4064}</strong></p>
<p>64-bit Windows only: 64-bit .NET Framework version 4.0 and later root directory.</p>
<p>An exception will be raised if an attempt is made to expand this constant on a system with no .NET Framework version 4.0 or later present.</p>
<p>仅适用于64位Windows：64位.NET Framework 4.0版和更高版本的根目录。</p>
<p>将系统扩展到.NET Framework 4.0或更高版本时，将发生例外。</p>
<h3 id="7-使用RegAsm-exe-注册-NET-DLL-文件"><a href="#7-使用RegAsm-exe-注册-NET-DLL-文件" class="headerlink" title="7. 使用RegAsm.exe 注册 .NET DLL 文件"></a>7. 使用RegAsm.exe 注册 .NET DLL 文件</h3><p>其中**[run]**的代码如下， 主意其WorkingDir参数，其表示运行注册程序的时候，运行的目录：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Filename: &quot;<span class="comment">&#123;dotnet20&#125;</span>\RegAsm.exe&quot;; Parameters: /codebase YourDLL.dll; WorkingDir: <span class="comment">&#123;app&#125;</span>; StatusMsg: &quot;Registering Controls...&quot;; Flags: runminimized</span><br></pre></td></tr></table></figure>

<h3 id="8-其它完整解决方案"><a href="#8-其它完整解决方案" class="headerlink" title="8. 其它完整解决方案"></a>8. 其它完整解决方案</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Other parts of installer file go here</span></span><br><span class="line">[CustomMessages]</span><br><span class="line">IDP_DownloadFailed=Download <span class="keyword">of</span> .NET Framework <span class="number">4.7</span>.<span class="number">2</span> failed. .NET Framework <span class="number">4.7</span> <span class="keyword">is</span> required <span class="keyword">to</span> run VidCoder.</span><br><span class="line">IDP_RetryCancel=Click <span class="string">&#x27;Retry&#x27;</span> <span class="keyword">to</span> <span class="keyword">try</span> downloading the files again, <span class="keyword">or</span> click <span class="string">&#x27;Cancel&#x27;</span> <span class="keyword">to</span> terminate setup.</span><br><span class="line">InstallingDotNetFramework=Installing .NET Framework <span class="number">4.7</span>.<span class="number">2</span>. This might take a few minutes...</span><br><span class="line">DotNetFrameworkFailedToLaunch=Failed <span class="keyword">to</span> launch .NET Framework Installer <span class="keyword">with</span> error &quot;<span class="number">%1</span>&quot;. Please fix the error <span class="keyword">then</span> run this installer again.</span><br><span class="line">DotNetFrameworkFailed1602=.NET Framework installation was cancelled. This installation can <span class="keyword">continue</span>, but be aware that this application may <span class="keyword">not</span> run unless the .NET Framework installation <span class="keyword">is</span> completed successfully.</span><br><span class="line">DotNetFrameworkFailed1603=A fatal error occurred <span class="keyword">while</span> installing the .NET Framework. Please fix the error, <span class="keyword">then</span> run the installer again.</span><br><span class="line">DotNetFrameworkFailed5100=Your computer does <span class="keyword">not</span> meet the requirements <span class="keyword">of</span> the .NET Framework. Please consult the documentation.</span><br><span class="line">DotNetFrameworkFailedOther=The .NET Framework installer exited <span class="keyword">with</span> an unexpected status code &quot;<span class="number">%1</span>&quot;. Please review any other messages shown by the installer <span class="keyword">to</span> determine whether the installation completed successfully, <span class="keyword">and</span> abort this installation <span class="keyword">and</span> fix the problem <span class="keyword">if</span> it did <span class="keyword">not</span>.</span><br><span class="line"></span><br><span class="line">[Code]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  requiresRestart: boolean;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NetFrameworkIsMissing</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  bSuccess: Boolean;</span><br><span class="line">  regVersion: Cardinal;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  Result := True;</span><br><span class="line"></span><br><span class="line">  bSuccess := RegQueryDWordValue(HKLM, <span class="string">&#x27;Software\Microsoft\NET Framework Setup\NDP\v4\Full&#x27;</span>, <span class="string">&#x27;Release&#x27;</span>, regVersion);</span><br><span class="line">  <span class="keyword">if</span> (True = bSuccess) <span class="keyword">and</span> (regVersion &gt;= <span class="number">461308</span>) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">    Result := False;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">InitializeWizard</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> NetFrameworkIsMissing() <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    idpAddFile(<span class="string">&#x27;http://go.microsoft.com/fwlink/?LinkId=863262&#x27;</span>, ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\NetFrameworkInstaller.exe&#x27;</span>));</span><br><span class="line">    idpDownloadAfter(wpReady);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallFramework</span><span class="params">()</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  StatusText: <span class="keyword">string</span>;</span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  StatusText := WizardForm.StatusLabel.Caption;</span><br><span class="line">  WizardForm.StatusLabel.Caption := CustomMessage(<span class="string">&#x27;InstallingDotNetFramework&#x27;</span>);</span><br><span class="line">  WizardForm.ProgressGauge.Style := npbstMarquee;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\NetFrameworkInstaller.exe&#x27;</span>), <span class="string">&#x27;/passive /norestart /showrmui /showfinalerror&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedToLaunch&#x27;</span>), [SysErrorMessage(resultCode)]);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="comment">// See https://msdn.microsoft.com/en-us/library/ee942965(v=vs.110).aspx#return_codes</span></span><br><span class="line">      <span class="keyword">case</span> resultCode <span class="keyword">of</span></span><br><span class="line">        <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">          <span class="comment">// Successful</span></span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="number">1602</span> : <span class="keyword">begin</span></span><br><span class="line">          MsgBox(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1602&#x27;</span>), mbInformation, MB_OK);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="number">1603</span>: <span class="keyword">begin</span></span><br><span class="line">          Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1603&#x27;</span>);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="number">1641</span>: <span class="keyword">begin</span></span><br><span class="line">          requiresRestart := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="number">3010</span>: <span class="keyword">begin</span></span><br><span class="line">          requiresRestart := True;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="number">5100</span>: <span class="keyword">begin</span></span><br><span class="line">          Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed5100&#x27;</span>);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">          MsgBox(FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedOther&#x27;</span>), [IntToStr(resultCode)]), mbError, MB_OK);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">finally</span></span><br><span class="line">    WizardForm.StatusLabel.Caption := StatusText;</span><br><span class="line">    WizardForm.ProgressGauge.Style := npbstNormal;</span><br><span class="line"></span><br><span class="line">    DeleteFile(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\NetFrameworkInstaller.exe&#x27;</span>));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrepareToInstall</span><span class="params">(<span class="keyword">var</span> NeedsRestart: Boolean)</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">// &#x27;NeedsRestart&#x27; only has an effect if we return a non-empty string, thus aborting the installation.</span></span><br><span class="line">  <span class="comment">// If the installers indicate that they want a restart, this should be done at the end of installation.</span></span><br><span class="line">  <span class="comment">// Therefore we set the global &#x27;restartRequired&#x27; if a restart is needed, and return this from NeedRestart()</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> NetFrameworkIsMissing() <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    Result := InstallFramework();</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NeedRestart</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  Result := requiresRestart;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>根据此版本修改后适用于自己项目的.NET框架安装代码如下：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallFrameworkWebRuntime</span><span class="params">()</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  WasVisible: Boolean;</span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>);</span><br><span class="line">  WasVisible := WizardForm.PreparingLabel.Visible;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">      WizardForm.PreparingLabel.Visible := True;</span><br><span class="line">      WizardForm.PreparingLabel.Caption := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkWebInstallerCaption&#x27;</span>), [TO_COMPARE_DOT_NET]);</span><br><span class="line">      ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>);</span><br><span class="line">      <span class="comment">//if not Exec(ExpandConstant(&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;), &#x27;/q /norestart&#x27;, &#x27;&#x27;, SW_SHOW, ewWaitUntilTerminated, ResultCode) then</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>), <span class="string">&#x27;/passive /norestart /showrmui /showfinalerror&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="comment">// https://docs.microsoft.com/de-de/windows/win32/debug/system-error-codes--0-499-</span></span><br><span class="line">          <span class="comment">// you can interact with the user that the installation failed, for example: error code 2: the system cannot find the file specified.</span></span><br><span class="line">          Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedToLaunch&#x27;</span>), [SysErrorMessage(ResultCode)])     </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">case</span> ResultCode <span class="keyword">of</span></span><br><span class="line">            <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">// Successful</span></span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1602</span> : <span class="keyword">begin</span></span><br><span class="line">              MsgBox(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1602&#x27;</span>), mbInformation, MB_OK);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1603</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1603&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1641</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">3010</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">5100</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed5100&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">//MsgBox(FmtMessage(CustomMessage(&#x27;DotNetFrameworkFailedOther&#x27;), [IntToStr(resultCode)]), mbError, MB_OK);</span></span><br><span class="line">              Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedOther&#x27;</span>), IntToStr(ResultCode));     </span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">finally</span></span><br><span class="line">    WizardForm.PreparingLabel.Visible := WasVisible;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  DeleteFile(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>));</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>上述代码中</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>); </span><br></pre></td></tr></table></figure>

<p>强制解压安装文件。该动作早于[Files]的运行。在安装结束之后删除该文件，使用代码如：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DeleteFile(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>有关.NET安装包运行时的错误代码可以参考连接：</p>
<p>// See <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/ee942965%28v=vs.110%29.aspx#return_codes">https://msdn.microsoft.com/en-us/library/ee942965(v=vs.110).aspx#return_codes</a></p>
<p>有关Exec函数，其错误代码为Windows系统错误代码，运行时的错误文本，可以参考连接：</p>
<p>// See [<a target="_blank" rel="noopener" href="https://docs.microsoft.com/de-de/windows/win32/debug/system-error-codes--0-499-]">https://docs.microsoft.com/de-de/windows/win32/debug/system-error-codes--0-499-]</a>(</p>
<h3 id="9-Inno-Setup-对注册表的操作"><a href="#9-Inno-Setup-对注册表的操作" class="headerlink" title="9. Inno Setup 对注册表的操作"></a>9. Inno Setup 对注册表的操作</h3><p>由于安装.NET的框架的目的就是要使用一下依赖.NET框架的动态库文件。而这部分DLL文件能够顺利使用就需要对该DLL文件进行注册。</p>
<h4 id="9-1-Regasm-程序集注册工具"><a href="#9-1-Regasm-程序集注册工具" class="headerlink" title="9.1 Regasm  程序集注册工具"></a>9.1 Regasm  程序集注册工具</h4><p><strong>Regasm 简介 ：</strong></p>
<p>EXE files such as RegAsm.exe are categorized as Executable Application (Windows Executable) files. As a Windows Executable file, it was created for use in Windows 10 by [Microsoft].</p>
<p>像RegAsm.exe这样的EXE文件都被分类为可执行应用程序（Windows Executable）文件。 作为Windows可执行文件，它由Microsoft创建供Windows 10使用。</p>
<p>The first version of RegAsm.exe for Windows Vista was introduced on 11/08/2006 in Windows Vista. The most recent version [file version 10] was introduced on 07/29/2015 for Windows 10. RegAsm.exe is bundled with the software package in Windows 10, Windows 8.1, and Windows 8.</p>
<p>Windows Vista的RegAsm.exe的第一版于2006年11月8日在Windows Vista中引入。 Windows 10的最新版本（文件版本10）已于07/29/2015引入。RegAsm.exe与Windows 10，Windows 8.1和Windows 8中的软件包捆绑在一起。</p>
<p>Please see below for more detailed information, <a target="_blank" rel="noopener" href="https://www.exefiles.com/en/extensions/exe/all-files/">EXE</a> file troubleshooting instructions, and free downloads of different versions of RegAsm.exe.</p>
<p>请参阅下面的详细信息，EXE文件故障排除说明以及RegAsm.exe不同版本的免费下载。</p>
<p><strong>作用：</strong> 读取程序集中的元数据，并将所需的项添加到注册表中。注册表允许 COM 客户程序以透明方式创建 .NET Framework 类。类一经注册，任何 COM 客户程序都可以使用它，就好像该类是一个 COM 类。类仅在安装程序集时注册一次。程序集中的类实例直到被实际注册时，才能从 COM 中创建。</p>
<p><strong>使用方法：</strong></p>
<p>regasm assemblyFile [options]</p>
<p><strong>重要参数：</strong></p>
<p>/codebase 在注册表中创建一个 Codebase 项。Codebase 项指定未安装到全局程序集缓存中的程序集的文件路径。如果随后要安装正在注册到全局程序集缓存中的程序集，则不应指定此选项。用 /codebase 选项指定的 assemblyFile 参数必须是具有强名称的程序集。</p>
<h4 id="9-2-Regsvr32-程序集注册工具"><a href="#9-2-Regsvr32-程序集注册工具" class="headerlink" title="9.2 Regsvr32  程序集注册工具"></a>9.2 Regsvr32  程序集注册工具</h4><p><strong>作用：</strong> Regsvr32命令用于注册COM组件，是 Windows 系统提供的用来向系统注册控件或者卸载控件的命令，以命令行方式运行。WinXP及以上系统的regsvr32.exe在windows\system32文件夹下；2000系统的regsvr32.exe在winnt\system32文件夹下。</p>
<h4 id="9-3-两个DLL注册工具的差异"><a href="#9-3-两个DLL注册工具的差异" class="headerlink" title="9.3 两个DLL注册工具的差异"></a>9.3 两个DLL注册工具的差异</h4><p>使用regasm.exe来注册.NET 组件，regsvr32并不适用于.NET组件。 （或者您也可以将regasm.exe理解为.NET的regsvr32）。regsvr32不适用于.NET的组件的注册，感觉意思是对于非托管的代码使用regsvr32来注册，对于托管的代码使用regasm来注册。</p>
<p><code>regsvr32</code> will load the library and try to call the <code>DllRegisterServer()</code> from that library. It doesn’t care what <code>DllRegisterServer()</code> actually does - it just calls that function and checks the returned value. You use it to register COM servers in unmanaged DLLs. It can’t generate a .tlb file.</p>
<p>regsvr32将加载该库并尝试从该库中调用DllRegisterServer（）。 不管DllRegisterServer（）实际做什么，它只是调用该函数并检查返回的值。 您可以使用它在非托管DLL中注册COM服务器。 无法生成.tlb文件。</p>
<p><code>regasm</code> will register a COM-exposed .NET assembly as a COM server. You use it for .NET assemblies. It can generate a .tlb file given the assembly only - it inspects the type infromation stored in the assembly and includes the COM-exposed entities into the type library.</p>
<p>regasm将把暴露于COM的.NET程序集注册为COM服务器。 您将其用于.NET程序集。 仅在给定程序集的情况下，它可以生成.tlb文件-它检查存储在程序集中的类型信息，并将COM公开的实体包括到类型库中。</p>
<h4 id="9-4-NET中“托管代码”和“非托管代码”的区别"><a href="#9-4-NET中“托管代码”和“非托管代码”的区别" class="headerlink" title="9.4  .NET中“托管代码”和“非托管代码”的区别"></a>9.4  .NET中“托管代码”和“非托管代码”的区别</h4><p><strong>托管代码</strong> <strong>(managed code)</strong></p>
<p>托管代码是Visual Basic .NET和C#编译器创建的代码。它运行在CLR(公共语言运行时)，除其他外，它提供像垃圾收集，运行时类型检查和引用检查的服务。所以，认为它是，“我的代码是由CLR管理。</p>
<p>Visual Basic和C#只能生成托管代码，所以，如果你正在用这些语言编写一个应用程序，你正在写一个由CLR管理的应用程序。如果您在Visual C .NET中编写应用程序，您可以根据需要生成托管代码，但它是可选的。</p>
<p><strong>非托管代码</strong> <strong>(unmanaged code)</strong></p>
<p>非托管代码直接编译为机器代码。因此，通过该定义，所有由传统C/C++编译器编译的代码是“非托管代码”。此外，由于它编译为机器代码而不是中间语言，所以它是不可移植的。</p>
<p>没有可用的内存管理或任何其他CLR提供。</p>
<p>由于您不能使用Visual Basic或C#创建非托管代码，在Visual Studio中，所有非托管代码都用C/C++编写。</p>
<p><strong>混合两者</strong></p>
<p>由于Visual C可以编译为托管代码或非托管代码，因此可以在同一个应用程序中混合这两个代码。这模糊了两者之间的界限，并使定义复杂化，但值得一提的是，你知道，如果你使用的第三方库有一些严重的非托管代码，你仍然可能有内存泄漏。</p>
<p><strong>区别：</strong></p>
<p>1、托管代码是一种中间语言，运行在CLR上；</p>
<p> 非托管代码被编译为机器码，运行在机器上。</p>
<p>2、托管代码独立于平台和语言，能更好的实现不同语言平台之间的兼容；</p>
<p> 非托管代码依赖于平台和语言。</p>
<p>3、托管代码可享受CLR提供的服务（如安全检测、垃圾回收等），不需要自己完成这些操作；</p>
<p> 非托管代码需要自己提供安全检测、垃圾回收等操作。</p>
<p>托管代码就意味着托管数据？答案是否定的。</p>
<p>对于Visual Basic和C#来说，生活是简单的，因为你没有其它选择。当你在那些语言里面声明一个类，那么这个类的实例会在托管堆中被创建，垃圾收集器(GC)会帮我们管理这些对象的回收。但是在Visual C++中，你有另一个选择。即使你正创建一个托管程序，你可以决定哪些类是托管类型，哪些类是非托管类型的。</p>
<p>这就是非托管类型：</p>
<p>class Foo { private: int x; public: Foo(): x(0){} Foo(int xx): x(xx) {} };</p>
<p>这就是托管类型</p>
<p>__gc class Bar { private: int x; public: Bar(): x(0){} Bar(int xx): x(xx) {} };</p>
<p>他们唯一的区别就是类Bar的定义中有__gc关键字。这个关键字会给代码带来巨大的区别。</p>
<h4 id="9-5-使用Inno-Setup的-Registry-段注册-NET相关DLL文件"><a href="#9-5-使用Inno-Setup的-Registry-段注册-NET相关DLL文件" class="headerlink" title="9.5 使用Inno Setup的 [Registry] 段注册.NET相关DLL文件"></a>9.5 使用Inno Setup的 [Registry] 段注册.NET相关DLL文件</h4><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[Registry]</span><br><span class="line">; ProgID part, TechTemp</span><br><span class="line">Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletekeyifempty</span><br><span class="line">Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM\CLSID&quot;; Flags: uninsdeletekey</span><br><span class="line">Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM\CLSID&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; Flags: uninsdeletevalue</span><br><span class="line">; CLSID Part, TechTemp </span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; Flags: uninsdeletekeyifempty</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">; CLSID Part\InprocServer32, TechTemp</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; Flags: uninsdeletekey</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;mscoree.dll&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;ThreadingModel&quot;; ValueData: &quot;Both&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;<span class="keyword">Class</span>&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;Assembly&quot;; ValueData: &quot;xxxxxxxxxxxxxxxxxxx, Version=<span class="number">1.0</span>.<span class="number">0.0</span>, Culture=neutral, PublicKeyToken=null&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;RuntimeVersion&quot;; ValueData: &quot;v4.<span class="number">0.30319</span>&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;CodeBase&quot;; ValueData: &quot;<span class="keyword">file</span>:<span class="comment">///&#123;#CommonappdataPathBackSlash&#125;/&#123;#AppPathBackSlash&#125;/bin/NET/xxxxxxxxxxxxxxxxxxx.dll&quot;; Flags: uninsdeletevalue</span></span><br><span class="line">; CLSID Part\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>, TechTemp</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; Flags: uninsdeletekey</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;<span class="keyword">Class</span>&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;Assembly&quot;; ValueData: &quot;xxxxxxxxxxxxxxxxxxx, Version=<span class="number">1.0</span>.<span class="number">0.0</span>, Culture=neutral, PublicKeyToken=null&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;RuntimeVersion&quot;; ValueData: &quot;v4.<span class="number">0.30319</span>&quot;; Flags: uninsdeletevalue</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;CodeBase&quot;; ValueData: &quot;<span class="keyword">file</span>:<span class="comment">///&#123;#CommonappdataPathBackSlash&#125;/&#123;#AppPathBackSlash&#125;/bin/NET/xxxxxxxxxxxxxxxxxxx.dll&quot;; Flags: uninsdeletevalue</span></span><br><span class="line">; CLSID Part\Implemented Categories, TechTemp</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\Implemented Categories&quot;; Flags: uninsdeletekey</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\Implemented Categories\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSIDImplementedCategories&#125;</span>&#125;&quot;; Flags: uninsdeletekey</span><br><span class="line">; CLSID Part\ProgId, TechTemp</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\ProgId&quot;; Flags: uninsdeletekey</span><br><span class="line">Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\ProgId&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br></pre></td></tr></table></figure>

<h3 id="10-项目完整代码，最小测试版"><a href="#10-项目完整代码，最小测试版" class="headerlink" title="10. 项目完整代码，最小测试版"></a>10. 项目完整代码，最小测试版</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br></pre></td><td class="code"><pre><span class="line">; -- Example1.iss --</span><br><span class="line">; Demonstrates copying <span class="number">3</span> files <span class="keyword">and</span> creating an icon.</span><br><span class="line"></span><br><span class="line">; SEE THE DOCUMENTATION <span class="keyword">FOR</span> DETAILS <span class="keyword">ON</span> CREATING .ISS SCRIPT FILES!</span><br><span class="line"></span><br><span class="line">#define ********AppPath</span><br><span class="line">#expr ********AppPath = &quot;\********\trunk\hcnt\wire\&quot;</span><br><span class="line"></span><br><span class="line">#define DotNetRegistToolPath</span><br><span class="line">#expr DotNetRegistToolPath = &quot;&quot;</span><br><span class="line"></span><br><span class="line">#define DotNetFrameWorkInstallerPath</span><br><span class="line">#expr DotNetFrameWorkInstallerPath = &quot;..\NET\NET_Framework_Runtime\<span class="number">462</span>\&quot;</span><br><span class="line"></span><br><span class="line">#define DotNet4OCTechTemplDllPath</span><br><span class="line">#expr DotNet4OCTechTemplDllPath = &quot;..\<span class="keyword">helper</span>\xxxxxxxxxxxxxxxxxxx&quot;</span><br><span class="line"></span><br><span class="line">#define DotNetFrameWorkOfflineInstaller</span><br><span class="line">#expr DotNetFrameWorkOfflineInstaller = &quot;ndp48-x86-x64-allos-enu.exe&quot;</span><br><span class="line"></span><br><span class="line">#define DotNetFrameWorkWebInstaller</span><br><span class="line">#expr DotNetFrameWorkWebInstaller = &quot;ndp48-web.exe&quot;</span><br><span class="line"></span><br><span class="line">;#define DotNetDllCLSID</span><br><span class="line">;#expr DotNetDllCLSID = &quot;<span class="number">62519924</span>-<span class="number">26</span>A8-<span class="number">3770</span>-<span class="number">9</span>F82-<span class="number">0</span>A0BC26EE7D4&quot;</span><br><span class="line"></span><br><span class="line">;#define DotNetDllCLSIDImplementedCategories</span><br><span class="line">;#expr DotNetDllCLSIDImplementedCategories = &quot;<span class="number">62</span>C8FE65-<span class="number">4</span>EBB-<span class="number">45</span>E7-B440-<span class="number">6</span>E39B2CDBF29&quot;</span><br><span class="line"></span><br><span class="line">;#define AppPathBackSlash</span><br><span class="line">;#expr AppPathBackSlash = &quot;********/trunk/hcnt/wire&quot;</span><br><span class="line"></span><br><span class="line">;#define CommonappdataPathBackSlash</span><br><span class="line">;#expr CommonappdataPathBackSlash = &quot;C:/ProgramData&quot;</span><br><span class="line"></span><br><span class="line">[Setup]</span><br><span class="line">;SignTool=MyCustom sign /a /tr http:<span class="comment">//sha256timestamp.ws.symantec.com/sha256/timestamp /d $q******** for SolidWorks 2020 Beta3$q $f</span></span><br><span class="line">PrivilegesRequired=admin </span><br><span class="line">AppName=My <span class="keyword">Program</span></span><br><span class="line">AppVersion=<span class="number">1.5</span></span><br><span class="line">WizardStyle=modern</span><br><span class="line">DefaultDirName=<span class="comment">&#123;autopf&#125;</span>\My <span class="keyword">Program</span></span><br><span class="line">DefaultGroupName=My <span class="keyword">Program</span></span><br><span class="line">UninstallDisplayIcon=<span class="comment">&#123;app&#125;</span>\MyProg.exe</span><br><span class="line">Compression=lzma2</span><br><span class="line">SolidCompression=yes</span><br><span class="line">OutputDir=userdocs:Inno Setup Examples Output</span><br><span class="line">ArchitecturesInstallIn64BitMode = x64</span><br><span class="line">ArchitecturesAllowed = x64</span><br><span class="line">SetupLogging=yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Languages]</span><br><span class="line"><span class="keyword">Name</span>: ENGLISH; MessagesFile: compiler:<span class="keyword">Default</span>.isl</span><br><span class="line"><span class="keyword">Name</span>: DEUTSCH; MessagesFile: compiler:Languages\German.isl; </span><br><span class="line"></span><br><span class="line">[Files]</span><br><span class="line">; .NET Part</span><br><span class="line">; .NET Framework Runtime, offline installer english all os runtime </span><br><span class="line">Source: &quot;<span class="comment">&#123;#DotNetFrameWorkInstallerPath&#125;</span><span class="comment">&#123;#DotNetFrameWorkOfflineInstaller&#125;</span>&quot;; DestDir: &quot;<span class="comment">&#123;tmp&#125;</span>&quot;; Flags: dontcopy noencryption;</span><br><span class="line">; .NET Framework Runtime, web installer <span class="keyword">for</span> other languages</span><br><span class="line">Source: &quot;<span class="comment">&#123;#DotNetFrameWorkInstallerPath&#125;</span><span class="comment">&#123;#DotNetFrameWorkWebInstaller&#125;</span>&quot;; DestDir: &quot;<span class="comment">&#123;tmp&#125;</span>&quot;; Flags: dontcopy noencryption;</span><br><span class="line">; xxxxxxxxxxxxxxxxxxx.dll + Hilfsdlls</span><br><span class="line">Source: &quot;<span class="comment">&#123;#DotNet4OCTechTemplDllPath&#125;</span>\*.*&quot;; DestDir: &quot;<span class="comment">&#123;commonappdata&#125;</span>\<span class="comment">&#123;#********AppPath&#125;</span>\bin\NET\&quot;; Flags: ignoreversion recursesubdirs; Permissions: everyone-full;</span><br><span class="line"></span><br><span class="line">Source: &quot;MyProg.exe&quot;; DestDir: &quot;<span class="comment">&#123;app&#125;</span>&quot;</span><br><span class="line">Source: &quot;MyProg.chm&quot;; DestDir: &quot;<span class="comment">&#123;app&#125;</span>&quot;</span><br><span class="line">Source: &quot;Readme.txt&quot;; DestDir: &quot;<span class="comment">&#123;app&#125;</span>&quot;; Flags: isreadme</span><br><span class="line"></span><br><span class="line">[Run]</span><br><span class="line">; Regist the .NET DLL <span class="keyword">file</span> by using the tool regasm.exe, return <span class="number">0</span>: ERROR_SUCCESS; <span class="number">1</span>:ERROR_INVALID_FUNCTION; <span class="number">2</span>:ERROR_FILE_NOT_FOUND; <span class="number">3</span>: ERROR_PATH_NOT_FOUND  </span><br><span class="line">Filename:  <span class="comment">&#123;code:GetCurrentRegAsmPath|&#123;#DotNetRegistToolPath&#125;</span>&#125;\regasm.exe; Parameters: &quot; &quot;&quot;<span class="comment">&#123;commonappdata&#125;</span>\<span class="comment">&#123;#********AppPath&#125;</span>\bin\NET\xxxxxxxxxxxxxxxxxxx.dll&quot;&quot; /codebase /verbose&quot;; WorkingDir: &quot;<span class="comment">&#123;commonappdata&#125;</span>\<span class="comment">&#123;#********AppPath&#125;</span>\bin\NET\&quot;; StatusMsg: Registering DLLs; Flags: <span class="number">64</span>bit runhidden waituntilterminated;</span><br><span class="line"></span><br><span class="line">[UninstallRun]</span><br><span class="line">; Regist the .NET DLL <span class="keyword">file</span> by using the tool regasm.exe, return <span class="number">0</span>: ERROR_SUCCESS; <span class="number">1</span>:ERROR_INVALID_FUNCTION; <span class="number">2</span>:ERROR_FILE_NOT_FOUND; <span class="number">3</span>: ERROR_PATH_NOT_FOUND  </span><br><span class="line">Filename:  <span class="comment">&#123;code:GetCurrentRegAsmPath|&#123;#DotNetRegistToolPath&#125;</span>&#125;\regasm.exe; Parameters: &quot;/unregister &quot;&quot;<span class="comment">&#123;commonappdata&#125;</span>\<span class="comment">&#123;#********AppPath&#125;</span>\bin\NET\xxxxxxxxxxxxxxxxxxx.dll&quot;&quot; /codebase /verbose&quot;; WorkingDir: &quot;<span class="comment">&#123;commonappdata&#125;</span>\<span class="comment">&#123;#********AppPath&#125;</span>\bin\NET\&quot;; StatusMsg: Unregistering DLLs; Flags: <span class="number">64</span>bit runhidden waituntilterminated;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[CustomMessages]</span><br><span class="line">; .NET Framwork installation processing </span><br><span class="line">ENGLISH.DotNetFrameworkOfflineInstallerCaption = Installing Microsoft .NET framework <span class="number">%1</span> offline installer <span class="keyword">for</span> Windows...</span><br><span class="line">ENGLISH.DotNetFrameworkWebInstallerCaption = Installing Microsoft .NET framework <span class="number">%1</span> Web installer <span class="keyword">for</span> Windows...</span><br><span class="line">ENGLISH.DotNetFrameworkFailedToLaunch = .NET installation failed <span class="keyword">with</span> code: <span class="number">%1</span>. Please fix the error <span class="keyword">then</span> run this installer again.</span><br><span class="line">ENGLISH.DotNetFrameworkFailed1602 = .NET Framework installation was cancelled. This installation can <span class="keyword">continue</span>, but be aware that this application may <span class="keyword">not</span> run unless the .NET Framework installation <span class="keyword">is</span> completed successfully.</span><br><span class="line">ENGLISH.DotNetFrameworkFailed1603 = A fatal error occurred <span class="keyword">while</span> installing the .NET Framework. Please fix the error, <span class="keyword">then</span> run the installer again.</span><br><span class="line">ENGLISH.DotNetFrameworkFailed5100 = Your computer does <span class="keyword">not</span> meet the requirements <span class="keyword">of</span> the .NET Framework. Please consult the documentation.</span><br><span class="line">ENGLISH.DotNetFrameworkFailedOther = The .NET Framework installer exited <span class="keyword">with</span> an unexpected status code &quot;<span class="number">%1</span>&quot;. Please review any other messages shown by the installer <span class="keyword">to</span> determine whether the installation completed successfully, <span class="keyword">and</span> abort this installation <span class="keyword">and</span> fix the problem <span class="keyword">if</span> it did <span class="keyword">not</span>.</span><br><span class="line"></span><br><span class="line">; .NET Framwork installation processing </span><br><span class="line">DEUTSCH.DotNetFrameworkOfflineInstallerCaption = Installation von Microsoft .NET Framework <span class="number">%1</span> offline Installationsprogramm für Windows ...</span><br><span class="line">DEUTSCH.DotNetFrameworkWebInstallerCaption = Installation von Microsoft .NET Framework <span class="number">%1</span> Web Installationsprogramm für Windows ...</span><br><span class="line">DEUTSCH.DotNetFrameworkFailedToLaunch = .NET Installation fehlgeschlagen mit Code: <span class="number">%1</span>. Bitte beheben Sie den Fehler und führen Sie das Installationsprogramm erneut aus.</span><br><span class="line">DEUTSCH.DotNetFrameworkFailed1602 = .NET Framework-Installation wurde abgebrochen. Diese Installation kann fortgesetzt werden. Beachten Sie jedoch, dass diese Anwendung möglicherweise erst ausgeführt wird, wenn die .NET Framework-Installation erfolgreich abgeschlossen wurde.</span><br><span class="line">DEUTSCH.DotNetFrameworkFailed1603 = Bei der Installation von .NET Framework ist ein schwerwiegender Fehler aufgetreten. Bitte beheben Sie den Fehler und führen Sie das Installationsprogramm erneut aus.</span><br><span class="line">DEUTSCH.DotNetFrameworkFailed5100 = Ihr Computer entspricht nicht den Anforderungen von .NET Framework. Bitte konsultieren Sie die Dokumentation.</span><br><span class="line">DEUTSCH.DotNetFrameworkFailedOther = Das .NET Framework-Installationsprogramm wurde mit dem unerwarteten Statuscode &quot;<span class="number">%1</span>&quot; beendet. Überprüfen Sie alle anderen vom Installationsprogramm angezeigten Meldungen, um festzustellen, ob die Installation erfolgreich abgeschlossen wurde, und brechen Sie diese Installation ab, und beheben Sie das Problem, wenn dies nicht der Fall ist.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;; Please <span class="keyword">do</span> <span class="keyword">not</span> delete the following, you can use it <span class="keyword">to</span> check the resgition <span class="keyword">of</span> the .NET DLL xxxxxxxxxxxxxxxxxxx.dll </span><br><span class="line">;; ProgID part, TechTemp</span><br><span class="line">;Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletekeyifempty</span><br><span class="line">;Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM\CLSID&quot;; Flags: uninsdeletekey</span><br><span class="line">;Root: HKCR; Subkey: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM\CLSID&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; Flags: uninsdeletevalue</span><br><span class="line">;; CLSID Part, TechTemp </span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; Flags: uninsdeletekeyifempty</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">;; CLSID Part\InprocServer32, TechTemp</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; Flags: uninsdeletekey</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;mscoree.dll&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;ThreadingModel&quot;; ValueData: &quot;Both&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;<span class="keyword">Class</span>&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;Assembly&quot;; ValueData: &quot;xxxxxxxxxxxxxxxxxxx, Version=<span class="number">1.0</span>.<span class="number">0.0</span>, Culture=neutral, PublicKeyToken=null&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;RuntimeVersion&quot;; ValueData: &quot;v4.<span class="number">0.30319</span>&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;CodeBase&quot;; ValueData: &quot;<span class="keyword">file</span>:<span class="comment">///&#123;#CommonappdataPathBackSlash&#125;/&#123;#AppPathBackSlash&#125;/bin/NET/xxxxxxxxxxxxxxxxxxx.dll&quot;; Flags: uninsdeletevalue</span></span><br><span class="line">;; CLSID Part\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>, TechTemp</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; Flags: uninsdeletekey</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;<span class="keyword">Class</span>&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;Assembly&quot;; ValueData: &quot;xxxxxxxxxxxxxxxxxxx, Version=<span class="number">1.0</span>.<span class="number">0.0</span>, Culture=neutral, PublicKeyToken=null&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;RuntimeVersion&quot;; ValueData: &quot;v4.<span class="number">0.30319</span>&quot;; Flags: uninsdeletevalue</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\InprocServer32\<span class="number">1.0</span>.<span class="number">0.0</span>&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;CodeBase&quot;; ValueData: &quot;<span class="keyword">file</span>:<span class="comment">///&#123;#CommonappdataPathBackSlash&#125;/&#123;#AppPathBackSlash&#125;/bin/NET/xxxxxxxxxxxxxxxxxxx.dll&quot;; Flags: uninsdeletevalue</span></span><br><span class="line">;; CLSID Part\Implemented Categories, TechTemp</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\Implemented Categories&quot;; Flags: uninsdeletekey</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\Implemented Categories\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSIDImplementedCategories&#125;</span>&#125;&quot;; Flags: uninsdeletekey</span><br><span class="line">;; CLSID Part\ProgId, TechTemp</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\ProgId&quot;; Flags: uninsdeletekey</span><br><span class="line">;Root: HKCR; Subkey: &quot;CLSID\<span class="comment">&#123;&#123;&#123;#DotNetDllCLSID&#125;</span>&#125;\ProgId&quot;; ValueType: <span class="keyword">string</span>; ValueName: &quot;&quot;; ValueData: &quot;XXXXXXXXXXXX.MMMMMMMMMMMMMMM&quot;; Flags: uninsdeletevalue</span><br><span class="line"></span><br><span class="line">[Icons]</span><br><span class="line"><span class="keyword">Name</span>: &quot;<span class="comment">&#123;group&#125;</span>\My <span class="keyword">Program</span>&quot;; Filename: &quot;<span class="comment">&#123;app&#125;</span>\MyProg.exe&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Code]</span><br><span class="line"><span class="keyword">const</span> TO_COMPARE_DOT_NET = <span class="string">&#x27;v4.6.2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bCancelWithoutPrompt: boolean;</span><br><span class="line">    bConnectWithNetwork: boolean;</span><br><span class="line">    bRequiresRestart: boolean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetCurrentRegAsmPath</span><span class="params">(S: <span class="keyword">String</span>)</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span> version: <span class="keyword">String</span>;</span><br><span class="line">    key: <span class="keyword">String</span>;</span><br><span class="line">    installPath: <span class="keyword">String</span>;</span><br><span class="line">    success: boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Result := S;</span><br><span class="line">    <span class="comment">// .NET 4.6.2 installs also as update to .NET 4.0 Full, you can also be on the safe side, check the windows 10 anniversary update</span></span><br><span class="line">    <span class="comment">// if the build was newer than (build 10.0.14393) with the code GetWindowsVersion &gt;= $A003839</span></span><br><span class="line">    <span class="keyword">if</span> TO_COMPARE_DOT_NET = <span class="string">&#x27;v4.6.2&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        version := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="comment">// .NET 4.5 installs as update to .NET 4.0 Full</span></span><br><span class="line">    <span class="keyword">if</span> TO_COMPARE_DOT_NET = <span class="string">&#x27;v4.5&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        version := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="comment">// installation key group for all .NET versions</span></span><br><span class="line">    key := <span class="string">&#x27;SOFTWARE\Microsoft\NET Framework Setup\NDP\&#x27;</span> + version;</span><br><span class="line">    success := RegQueryStringValue(HKLM, key, <span class="string">&#x27;InstallPath&#x27;</span>, installPath);</span><br><span class="line">    <span class="keyword">if</span> (success = True) <span class="keyword">and</span> (S = <span class="string">&#x27;&#x27;</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      Result := installPath;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallFrameworkWebRuntime</span><span class="params">()</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  WasVisible: Boolean;</span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>);</span><br><span class="line">  WasVisible := WizardForm.PreparingLabel.Visible;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">      WizardForm.PreparingLabel.Visible := True;</span><br><span class="line">      WizardForm.PreparingLabel.Caption := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkWebInstallerCaption&#x27;</span>), [TO_COMPARE_DOT_NET]);</span><br><span class="line">      ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>);</span><br><span class="line">      <span class="comment">//if not Exec(ExpandConstant(&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;), &#x27;/q /norestart&#x27;, &#x27;&#x27;, SW_SHOW, ewWaitUntilTerminated, ResultCode) then</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>), <span class="string">&#x27;/passive /norestart /showrmui /showfinalerror&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="comment">// https://docs.microsoft.com/de-de/windows/win32/debug/system-error-codes--0-499-</span></span><br><span class="line">          <span class="comment">// you can interact with the user that the installation failed, for example: error code 2: the system cannot find the file specified.</span></span><br><span class="line">          Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedToLaunch&#x27;</span>), [SysErrorMessage(ResultCode)])     </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">case</span> ResultCode <span class="keyword">of</span></span><br><span class="line">            <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">// Successful</span></span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1602</span> : <span class="keyword">begin</span></span><br><span class="line">              MsgBox(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1602&#x27;</span>), mbInformation, MB_OK);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1603</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1603&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1641</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">3010</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">5100</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed5100&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">//MsgBox(FmtMessage(CustomMessage(&#x27;DotNetFrameworkFailedOther&#x27;), [IntToStr(resultCode)]), mbError, MB_OK);</span></span><br><span class="line">              Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedOther&#x27;</span>), IntToStr(ResultCode));     </span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">finally</span></span><br><span class="line">    WizardForm.PreparingLabel.Visible := WasVisible;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  DeleteFile(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkWebInstaller&#125;&#x27;</span>));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallFrameworkOfflineRuntime</span><span class="params">()</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  WasVisible: Boolean;</span><br><span class="line">  ResultCode: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  WasVisible := WizardForm.PreparingLabel.Visible;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">      WizardForm.PreparingLabel.Visible := True;</span><br><span class="line">      WizardForm.PreparingLabel.Caption := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkOfflineInstallerCaption&#x27;</span>), [TO_COMPARE_DOT_NET]);</span><br><span class="line">      ExtractTemporaryFile(<span class="string">&#x27;&#123;#DotNetFrameWorkOfflineInstaller&#125;&#x27;</span>);</span><br><span class="line">      <span class="comment">//if not Exec(ExpandConstant(&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkOfflineInstaller&#125;&#x27;), &#x27;/q /norestart&#x27;, &#x27;&#x27;, SW_SHOW, ewWaitUntilTerminated, ResultCode) then</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> Exec(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkOfflineInstaller&#125;&#x27;</span>), <span class="string">&#x27;/passive /norestart /showrmui /showfinalerror&#x27;</span>, <span class="string">&#x27;&#x27;</span>, SW_SHOW, ewWaitUntilTerminated, ResultCode) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="comment">// https://docs.microsoft.com/de-de/windows/win32/debug/system-error-codes--0-499-</span></span><br><span class="line">          <span class="comment">// you can interact with the user that the installation failed, for example: error code 2: the system cannot find the file specified.</span></span><br><span class="line">          Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedToLaunch&#x27;</span>), [SysErrorMessage(ResultCode)])     </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">case</span> ResultCode <span class="keyword">of</span></span><br><span class="line">            <span class="number">0</span>: <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">// Successful</span></span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1602</span> : <span class="keyword">begin</span></span><br><span class="line">              MsgBox(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1602&#x27;</span>), mbInformation, MB_OK);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1603</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed1603&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">1641</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">3010</span>: <span class="keyword">begin</span></span><br><span class="line">              bRequiresRestart := True;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="number">5100</span>: <span class="keyword">begin</span></span><br><span class="line">              Result := CustomMessage(<span class="string">&#x27;DotNetFrameworkFailed5100&#x27;</span>);</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              <span class="comment">//MsgBox(FmtMessage(CustomMessage(&#x27;DotNetFrameworkFailedOther&#x27;), [IntToStr(resultCode)]), mbError, MB_OK);</span></span><br><span class="line">              Result := FmtMessage(CustomMessage(<span class="string">&#x27;DotNetFrameworkFailedOther&#x27;</span>), IntToStr(ResultCode));</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">finally</span></span><br><span class="line">    WizardForm.PreparingLabel.Visible := WasVisible;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  DeleteFile(ExpandConstant(<span class="string">&#x27;&#123;tmp&#125;\&#123;#DotNetFrameWorkOfflineInstaller&#125;&#x27;</span>));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsNetWorkActivatedTried</span>:</span> boolean;</span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">  WinHttpReq: Variant;</span><br><span class="line">  Connected: Boolean;</span><br><span class="line">  iTriedTime: Integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  Connected := False;</span><br><span class="line">  iTriedTime := <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    iTriedTime := iTriedTime + <span class="number">1</span>;</span><br><span class="line">    Log(<span class="string">&#x27;Checking connection to the server, try &#x27;</span> +  + IntToStr(iTriedTime) + <span class="string">&#x27; time.&#x27;</span>);</span><br><span class="line">    <span class="keyword">try</span> </span><br><span class="line">      WinHttpReq := CreateOleObject(<span class="string">&#x27;WinHttp.WinHttpRequest.5.1&#x27;</span>);</span><br><span class="line">      WinHttpReq.SetTimeouts(<span class="string">&#x27;3000&#x27;</span>, <span class="string">&#x27;3000&#x27;</span>, <span class="string">&#x27;3000&#x27;</span>, <span class="string">&#x27;3000&#x27;</span>);</span><br><span class="line">      <span class="comment">// Use your real server host name </span></span><br><span class="line">      WinHttpReq.Open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://www.camtek.de/&#x27;</span>, False);</span><br><span class="line">      WinHttpReq.Send(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      Log(<span class="string">&#x27;Connected to the server; status: &#x27;</span> + IntToStr(WinHttpReq.Status) + <span class="string">&#x27; &#x27;</span> +</span><br><span class="line">          WinHttpReq.StatusText);</span><br><span class="line">      Connected := True;</span><br><span class="line">    <span class="keyword">except</span></span><br><span class="line">      Log(<span class="string">&#x27;Error connecting to the server, msg: &#x27;</span> + GetExceptionMessage + <span class="string">&#x27;try again! &#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> (iTriedTime = <span class="number">3</span>) <span class="keyword">or</span> (Connected = True) ;</span><br><span class="line">  Result := Connected;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsDotNetDetected</span><span class="params">(version: <span class="keyword">string</span>; service: cardinal)</span>:</span> boolean;</span><br><span class="line"><span class="comment">// Indicates whether the specified version and service pack of the .NET Framework is installed.</span></span><br><span class="line"><span class="comment">// see the link: https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed?redirectedfrom=MSDN#net_b</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// version -- Specify one of these strings for the required .NET Framework version:</span></span><br><span class="line"><span class="comment">//    &#x27;v1.1.4322&#x27;     .NET Framework 1.1</span></span><br><span class="line"><span class="comment">//    &#x27;v2.0.50727&#x27;    .NET Framework 2.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.0&#x27;          .NET Framework 3.0</span></span><br><span class="line"><span class="comment">//    &#x27;v3.5&#x27;          .NET Framework 3.5</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Client&#x27;     .NET Framework 4.0 Client Profile</span></span><br><span class="line"><span class="comment">//    &#x27;v4\Full&#x27;       .NET Framework 4.0 Full Installation</span></span><br><span class="line"><span class="comment">//    &#x27;v4.5&#x27;          .NET Framework 4.5 378389</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6&#x27;          .NET Framework 4.6 393295</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.1&#x27;        .NET Framework 4.6.1 394254</span></span><br><span class="line"><span class="comment">//    &#x27;v4.6.2&#x27;        .NET Framework 4.6.2 394802</span></span><br><span class="line"><span class="comment">//    &#x27;v4.7&#x27;          .NET Framework 4.7 393295</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// service -- Specify any non-negative integer for the required service pack level:</span></span><br><span class="line"><span class="comment">//    0               No service packs required</span></span><br><span class="line"><span class="comment">//    1, 2, etc.      Service pack 1, 2, etc. required</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">    key: <span class="keyword">string</span>;</span><br><span class="line">    install, release, serviceCount: cardinal;</span><br><span class="line">    check45, check462, success: boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.6.2 installs also as update to .NET 4.0 Full, you can also be on the safe side, check the windows 10 anniversary update</span></span><br><span class="line">    <span class="comment">// if the build was newer than (build 10.0.14393) with the code GetWindowsVersion &gt;= $A003839</span></span><br><span class="line">    <span class="keyword">if</span> version = <span class="string">&#x27;v4.6.2&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        version := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">        check462 := true;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">        check462 := false;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.5 installs as update to .NET 4.0 Full</span></span><br><span class="line">    <span class="keyword">if</span> version = <span class="string">&#x27;v4.5&#x27;</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        version := <span class="string">&#x27;v4\Full&#x27;</span>;</span><br><span class="line">        check45 := true;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">        check45 := false;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// installation key group for all .NET versions</span></span><br><span class="line">    key := <span class="string">&#x27;SOFTWARE\Microsoft\NET Framework Setup\NDP\&#x27;</span> + version;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 3.0 uses value InstallSuccess in subkey Setup</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v3.0&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key + <span class="string">&#x27;\Setup&#x27;</span>, <span class="string">&#x27;InstallSuccess&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Install&#x27;</span>, install);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.0/4.5 uses value Servicing instead of SP</span></span><br><span class="line">    <span class="keyword">if</span> Pos(<span class="string">&#x27;v4&#x27;</span>, version) = <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Servicing&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;SP&#x27;</span>, serviceCount);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.5 uses additional value Release</span></span><br><span class="line">    <span class="keyword">if</span> check45 <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Release&#x27;</span>, release);</span><br><span class="line">        success := success <span class="keyword">and</span> (release &gt;= <span class="number">378389</span>);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .NET 4.6.2 uses additional value Release</span></span><br><span class="line">    <span class="keyword">if</span> check462 <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        success := success <span class="keyword">and</span> RegQueryDWordValue(HKLM, key, <span class="string">&#x27;Release&#x27;</span>, release);</span><br><span class="line">        success := success <span class="keyword">and</span> (release &gt;= <span class="number">394802</span>);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">    Result := success <span class="keyword">and</span> (install = <span class="number">1</span>) <span class="keyword">and</span> (serviceCount &gt;= service);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsRequiredDotNetDetected</span>:</span> Boolean;  </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Result := IsDotNetDetected(TO_COMPARE_DOT_NET, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallDotNetOfflineRuntime</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bConnectWithNetwork <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        Result := True;</span><br><span class="line">      <span class="keyword">end</span> </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> ActiveLanguage = <span class="string">&#x27;ENGLISH&#x27;</span> <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">             Result := True;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            Result := False;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InstallDotNetWebRuntime</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> bConnectWithNetwork) <span class="keyword">and</span> ( <span class="keyword">not</span> ActiveLanguage = <span class="string">&#x27;ENGLISH&#x27;</span>) <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        Result := True;</span><br><span class="line">      <span class="keyword">end</span> </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        Result := False;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InitializeSetup</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    bConnectWithNetwork := IsNetWorkActivatedTried;</span><br><span class="line">    Result := True;</span><br><span class="line"><span class="keyword">end</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrepareToInstall</span><span class="params">(<span class="keyword">var</span> NeedsRestart: Boolean)</span>:</span> <span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">var</span> bInstallWeb: boolean;</span><br><span class="line">    bInstallStd: boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">// &#x27;NeedsRestart&#x27; only has an effect if we return a non-empty string, thus aborting the installation.</span></span><br><span class="line">  <span class="comment">// If the installers indicate that they want a restart, this should be done at the end of installation.</span></span><br><span class="line">  <span class="comment">// Therefore we set the global &#x27;restartRequired&#x27; if a restart is needed, and return this from NeedRestart()</span></span><br><span class="line">  bCancelWithoutPrompt := false;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> IsRequiredDotNetDetected <span class="keyword">then</span> </span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      bInstallWeb := InstallDotNetWebRuntime;</span><br><span class="line">      bInstallStd := InstallDotNetOfflineRuntime;</span><br><span class="line">      <span class="keyword">if</span> ( bInstallWeb = True) <span class="keyword">then</span> </span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          Result := InstallFrameworkWebRuntime</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( bInstallStd = True) <span class="keyword">then</span> </span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          Result := InstallFrameworkOfflineRuntime</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          Result := InstallFrameworkWebRuntime</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;          </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NeedRestart</span><span class="params">()</span>:</span> Boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  Result := bRequiresRestart;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>欢迎订阅我的个人微信公众号，一起讨论学习。</p>
<hr>

    </div>

    
    <div class="about">
        <h1>关于本文</h1>
        <div class="details">
            <p>由 Barbossa Wang 撰写, 采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a> 许可协议.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/Inno-Setup/" class="tag">#Inno Setup</a><a href="/tags/NET/" class="tag">#.NET</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/posts/inno-03-check-network-state.html" class="next">
            <div>
                <div class="text">
                    <p class="label">下一篇</p>
                    <h3 class="title">Inno Setup 检查网络连接的Pascal代码</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/posts/inno-01-run-as-admin.html" class="prev">
            <div>
                <div class="text">
                    <p class="label">上一篇</p>
                    <h3 class="title">Inno Setup 如何以管理员的身份运行</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/zicowarn" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/zhichao-wang-a16662109" class="item">linkedIn</a>
                
                <a href="mailto:mr.will.com@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 Barbossa Wang<br>由 <a href="http://hexo.io/" target="_blank">Hexo</a> 驱动 </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>